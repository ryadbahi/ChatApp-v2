import{j as e,A as L,m as S}from"./ui-vendor-BEMU751j.js";import{r as h}from"./react-vendor-oin3n_bH.js";import{c as O,d as $,e as z,r as D,f as H}from"./social-PyUT3FD-.js";import{j as E,o as C,l as M,x as B,m as G,s as i}from"./auth-CEE9aHD-.js";import"./chat-xRr-uYkC.js";import"./editor-vendor-DpIsqUJN.js";import"./socket-vendor-BLRFddlS.js";const J=({activeTab:t,onTabChange:n,onClose:d,receivedRequestsCount:a})=>e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/20",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Friends"}),e.jsxs("div",{className:"flex bg-white/10 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>n("friends"),className:`flex items-center gap-2 px-3 py-2 rounded-md text-sm transition-colors ${t==="friends"?"bg-purple-500/30 text-white":"text-white/70 hover:text-white"}`,children:[e.jsx(E,{}),e.jsx("span",{children:"Friends"})]}),e.jsxs("button",{onClick:()=>n("requests"),className:`flex items-center gap-2 px-3 py-2 rounded-md text-sm transition-colors relative ${t==="requests"?"bg-purple-500/30 text-white":"text-white/70 hover:text-white"}`,children:[e.jsx(C,{}),e.jsx("span",{children:"Requests"}),a>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:a>9?"9+":a})]})]})]}),e.jsx("button",{onClick:d,className:"text-white/70 hover:text-white text-xl leading-none w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10 transition-colors",children:"Ã—"})]}),K=({friend:t,isOnline:n,onOpenDM:d,onEndFriendship:a})=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[t.avatar?e.jsx("img",{src:t.avatar,alt:t.username,className:"w-10 h-10 rounded-full border-2 border-white/20"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center border-2 border-white/20",children:e.jsx("span",{className:"text-white text-sm font-medium",children:t.username.charAt(0).toUpperCase()})}),e.jsx("div",{className:`absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white ${n?"bg-green-500":"bg-gray-500"}`})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:t.username}),e.jsx("p",{className:"text-xs text-white/60",children:n?"Online":"Offline"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>d(t),className:"px-3 py-1 bg-purple-500/20 text-purple-300 rounded-md hover:bg-purple-500/30 transition-colors text-sm",children:"Message"}),e.jsx("button",{onClick:()=>a(t._id,t.friendshipId),className:"p-2 text-red-400 hover:text-red-300 hover:bg-red-500/20 rounded-md transition-colors",title:"End friendship",children:e.jsx(M,{className:"text-sm"})})]})]}),Q=({friends:t,onlineFriends:n,onOpenDM:d,onEndFriendship:a,loading:c})=>c?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}):!Array.isArray(t)||t.length===0?e.jsxs("div",{className:"text-center text-white/60 py-8",children:[e.jsx(E,{className:"text-4xl mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No friends yet"}),e.jsx("p",{className:"text-sm",children:"Start connecting with people!"})]}):e.jsx("div",{className:"p-4 space-y-3",children:t.map(l=>e.jsx(K,{friend:l,isOnline:n.has(l._id),onOpenDM:d,onEndFriendship:a},l._id))}),q=({request:t,type:n,onAccept:d,onReject:a})=>{const c=n==="received"?t.sender:t.recipient;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[c.avatar?e.jsx("img",{src:c.avatar,alt:c.username,className:"w-10 h-10 rounded-full border-2 border-white/20"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center border-2 border-white/20",children:e.jsx("span",{className:"text-white text-sm font-medium",children:c.username.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:c.username}),e.jsx("p",{className:"text-xs text-white/60",children:n==="received"?"wants to be friends":"request pending"})]})]}),n==="received"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>d?.(t._id),className:"p-2 text-green-400 hover:text-green-300 hover:bg-green-500/20 rounded-md transition-colors",title:"Accept",children:e.jsx(B,{})}),e.jsx("button",{onClick:()=>a?.(t._id),className:"p-2 text-red-400 hover:text-red-300 hover:bg-red-500/20 rounded-md transition-colors",title:"Reject",children:e.jsx(G,{})})]}):e.jsx("div",{className:"text-yellow-400 text-sm",children:"Pending"})]})},V=({friendRequests:t,onAcceptRequest:n,onRejectRequest:d,loading:a})=>a?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}):Array.isArray(t.received)&&t.received.length>0||Array.isArray(t.sent)&&t.sent.length>0?e.jsxs("div",{className:"p-4 space-y-3",children:[Array.isArray(t.received)&&t.received.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white/80 mb-2",children:"Received"}),t.received.map(l=>e.jsx("div",{className:"mb-2",children:e.jsx(q,{request:l,type:"received",onAccept:n,onReject:d})},l._id))]}),Array.isArray(t.sent)&&t.sent.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white/80 mb-2",children:"Sent"}),t.sent.map(l=>e.jsx("div",{className:"mb-2",children:e.jsx(q,{request:l,type:"sent"})},l._id))]})]}):e.jsxs("div",{className:"text-center text-white/60 py-8",children:[e.jsx(C,{className:"text-4xl mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No pending requests"})]}),se=({isOpen:t,onClose:n,onOpenDM:d,onOnlineFriendsChange:a,onFriendRequestCountChange:c})=>{const[l,b]=h.useState([]),[j,p]=h.useState({sent:[],received:[]}),[v,y]=h.useState(new Set),[g,N]=h.useState(!1),[F,_]=h.useState("friends");h.useEffect(()=>{t&&m()},[t]),h.useEffect(()=>{const s=j.received.length;c?.(s)},[j.received.length,c]),h.useEffect(()=>{if(!i)return;const s=({userId:o,isOnline:x})=>{y(u=>{const w=new Set(u);return x?w.add(o):w.delete(o),w})},r=o=>{p(x=>({...x,received:[...x.received,o]}))},f=()=>{m()},A=()=>{m()},R=({requestId:o})=>{p(x=>({sent:x.sent.filter(u=>u._id!==o),received:x.received.filter(u=>u._id!==o)}))},k=()=>{m()};return i.on("friendOnlineStatusUpdate",s),i.on("newFriendRequest",r),i.on("friendRequestAccepted",f),i.on("friendshipCreated",A),i.on("friendRequestRejected",R),i.on("friendshipEnded",k),i.emit("getOnlineFriends",({onlineFriends:o})=>{const x=new Set(o.map(u=>u._id));y(x)}),()=>{i.off("friendOnlineStatusUpdate",s),i.off("newFriendRequest",r),i.off("friendRequestAccepted",f),i.off("friendshipCreated",A),i.off("friendRequestRejected",R),i.off("friendshipEnded",k)}},[i,a]),h.useEffect(()=>{typeof a=="function"&&a(Array.from(v))},[v]);const m=async()=>{N(!0);try{const[s,r]=await Promise.all([O(),$()]);s.success&&s.data&&Array.isArray(s.data)?b(s.data):b([]),r.success&&r.data&&typeof r.data=="object"&&Array.isArray(r.data.sent)&&Array.isArray(r.data.received)?p(r.data):p({sent:[],received:[]})}catch(s){console.error("Failed to load friends data:",s),b([]),p({sent:[],received:[]})}finally{N(!1)}},U=async s=>{try{(await H(s)).success&&(i?.emit("acceptFriendRequest",{requestId:s}),m())}catch(r){console.error("Failed to accept friend request:",r)}},P=async s=>{try{(await D(s)).success&&(i?.emit("rejectFriendRequest",{requestId:s}),m())}catch(r){console.error("Failed to reject friend request:",r)}},T=async(s,r)=>{try{(await z(r)).success&&(i?.emit("endFriendship",{friendId:s,friendshipId:r}),m())}catch(f){console.error("Failed to end friendship:",f)}};return t?e.jsx(L,{children:e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:n,children:e.jsxs(S.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:s=>s.stopPropagation(),className:"w-full max-w-2xl bg-white/10 backdrop-blur-md rounded-xl shadow-xl border border-white/20 overflow-hidden",children:[e.jsx(J,{activeTab:F,onTabChange:_,onClose:n,receivedRequestsCount:j.received.length}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:F==="friends"?e.jsx(Q,{friends:l,onlineFriends:v,onOpenDM:d,onEndFriendship:T,loading:g}):e.jsx(V,{friendRequests:j,onAcceptRequest:U,onRejectRequest:P,loading:g})})]})})}):null};export{se as default};
