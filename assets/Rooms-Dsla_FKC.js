import{j as s}from"./ui-vendor-BEMU751j.js";import{r as t}from"./react-vendor-oin3n_bH.js";import{s as r,v as E}from"./auth-CEE9aHD-.js";import{u as P,C as A,g as F,a as L,b as U}from"./chat-xRr-uYkC.js";import"./social-PyUT3FD-.js";import"./socket-vendor-BLRFddlS.js";import"./editor-vendor-DpIsqUJN.js";const w=({label:l,isActive:c,onClick:d})=>s.jsx("button",{onClick:d,className:`px-4 py-2 rounded-lg transition-colors ${c?"bg-white/10 text-white":"text-white/70 hover:bg-white/5"}`,children:l}),T=({rooms:l,isCreated:c=!1,onUpdate:d,onRoomEdited:u,onRoomDeleted:x,userCounts:f})=>s.jsx("div",{className:"grid gap-8 w-full max-w-6xl sm:grid-cols-2 lg:grid-cols-3",children:l.map(i=>{const p=i.visibility==="public";return s.jsx(U,{room:i,isCreated:c,onUpdate:d,onRoomEdited:u,onRoomDeleted:x,userCount:p?f[i._id]??0:void 0},i._id)})}),V=()=>{const[l,c]=t.useState("all"),[d,u]=t.useState([]),[x,f]=t.useState([]),[i,p]=t.useState(null),[k,C]=t.useState(!0),[N,h]=t.useState(!1),[S,b]=t.useState({}),[v,m]=t.useState({message:"",visible:!1,type:"success"}),{joinRoomWithLoading:_,addRoomCreatedListener:y,removeRoomCreatedListener:j}=P(),R=async()=>{C(!0),p(null);try{const[e,o]=await Promise.all([F(),L()]);u(e),f(o)}catch(e){p("Failed to load rooms. Please try again later."),console.error("[Rooms] Failed to fetch rooms:",e)}finally{C(!1)}};return t.useEffect(()=>{R()},[]),t.useEffect(()=>{const e=o=>{const g={...o,_id:o._id||o.id};u(a=>[g,...a]),f(a=>[g,...a]),R().catch(a=>{console.error("Failed to refresh rooms from backend:",a)})};return y(e),()=>j(e)},[y,j]),t.useEffect(()=>{r.connected?r.emit("getPublicRoomsUserCounts",o=>{b(o||{})}):r.on("connect",()=>{r.emit("getPublicRoomsUserCounts",o=>{b(o||{})})});const e=setInterval(()=>{r.connected&&r.emit("getPublicRoomsUserCounts",o=>{b(o||{})})},1e4);return()=>clearInterval(e)},[l,d,x]),t.useEffect(()=>{const e=o=>{b(o||{})};return r.on("allRoomCounts",e),r.connected||r.connect(),()=>{r.off("allRoomCounts",e)}},[]),s.jsxs("div",{className:"w-full h-full flex flex-col items-center",children:[s.jsx(E,{message:v.message,type:v.type,isVisible:v.visible,onClose:()=>m(e=>({...e,visible:!1}))}),N&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>h(!1),children:s.jsx("div",{className:"w-full max-w-md",onClick:e=>e.stopPropagation(),children:s.jsx(A,{onSuccess:async(e,o,g)=>{console.log("Room creation successful, handling response:",e),m({message:"Room created successfully!",visible:!0,type:"success"});const a={...e,_id:e._id||e.id};l==="all"&&u(n=>[a,...n]),f(n=>[a,...n]);try{await R()}catch(n){console.error("Failed to refresh rooms from backend:",n)}if(o&&a._id){m({message:"Joining room...",visible:!0,type:"info"});try{console.log("[Rooms] Calling joinRoomWithLoading with:",a._id),await _(a._id,{delay:500})}catch(n){console.error("Join failed",n),m({message:"Failed to join room. Please try manually.",visible:!0,type:"error"})}}h(!1),g?.()},onCancel:()=>h(!1)})})}),s.jsxs("div",{className:"w-full max-w-6xl space-y-8",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h1",{className:"text-4xl font-bold text-white",children:"Chat Rooms"}),s.jsx("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-gradient-to-r from-pink-500/80 to-purple-500/80 text-white rounded-lg hover:from-pink-600/80 hover:to-purple-600/80 transition-colors",children:"Create Room"})]}),s.jsxs("div",{className:"w-full flex justify-center mb-6",children:[s.jsx(w,{label:"All Rooms",isActive:l==="all",onClick:()=>c("all")}),s.jsx(w,{label:"My Created Rooms",isActive:l==="created",onClick:()=>c("created")})]}),i?s.jsx("div",{className:"text-center text-red-400 bg-red-500/10 backdrop-blur-sm p-4 rounded-lg",children:i}):k?s.jsx("div",{className:"flex justify-center items-center py-10",children:s.jsx("div",{className:"animate-spin h-10 w-10 border-4 border-blue-500 rounded-full border-t-transparent"})}):s.jsx(T,{rooms:l==="all"?d:x,isCreated:l==="created",onUpdate:R,onRoomEdited:()=>m({message:"Room updated successfully!",visible:!0,type:"success"}),onRoomDeleted:()=>m({message:"Room deleted successfully!",visible:!0,type:"info"}),userCounts:S})]})]})};export{V as default};
