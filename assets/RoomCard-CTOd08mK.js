import{j as e}from"./ui-vendor-BEMU751j.js";import{r as d,u as k}from"./react-vendor-oin3n_bH.js";import{e as R,a as S,b as N,F as C,k as E,l as F}from"./auth-CEE9aHD-.js";import{u as P,h as _,i as D}from"./chat-xRr-uYkC.js";import"./socket-vendor-BLRFddlS.js";import"./social-PyUT3FD-.js";import"./editor-vendor-DpIsqUJN.js";const L=({room:t,onSave:v,onCancel:p})=>{const[i,w]=d.useState(t.name),[a,y]=d.useState(t.visibility),[l,f]=d.useState(""),[u,g]=d.useState(!1),[b,r]=d.useState(null),[h,n]=d.useState(!1),x=a!=="public"&&t.visibility==="public",j=async s=>{if(s.preventDefault(),r(null),n(!0),!i.trim()){r("Room name is required"),n(!1);return}if(i.length<3||i.length>50){r("Room name must be between 3 and 50 characters"),n(!1);return}if(!/^[a-zA-Z0-9\s-_]+$/.test(i)){r("Room name can only contain letters, numbers, spaces, hyphens, and underscores"),n(!1);return}if(x&&!l){r("Password is required for private or secret rooms"),n(!1);return}try{const c={name:i.trim(),visibility:a};(l||x)&&Object.assign(c,{password:l}),await v(c)}catch(c){console.error("[EditRoomModal] Error:",c),r(c.response?.data?.msg||"Failed to update room"),n(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"w-full max-w-md backdrop-blur-lg bg-white/10 p-6 rounded-xl border border-white/20",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white mb-6",children:"Edit Room"}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-white/90 mb-1",children:"Room Name"}),e.jsx("input",{type:"text",id:"name",value:i,onChange:s=>w(s.target.value),className:`w-full px-4 py-2 rounded-lg bg-black/20 border border-white/10 
                       focus:border-blue-500/50 focus:ring-2 focus:ring-blue-500/30 
                       outline-none text-white placeholder-white/50`,placeholder:"Enter room name"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"visibility",className:"block text-sm font-medium text-white/90 mb-1",children:"Visibility"}),e.jsxs("select",{id:"visibility",value:a,onChange:s=>y(s.target.value),className:`w-full px-4 py-2 rounded-lg bg-black/20 border border-white/10 
                       focus:border-blue-500/50 focus:ring-2 focus:ring-blue-500/30 
                       outline-none text-white`,children:[e.jsx("option",{value:"public",children:"Public (visible to all)"}),e.jsx("option",{value:"private",children:"Private (visible but requires permission)"}),e.jsx("option",{value:"secret",children:"Secret (hidden unless shared)"})]})]}),a!=="public"&&e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"password",className:"block text-sm font-medium text-white/90 mb-1",children:["Password"," ",t.visibility!=="public"?"(leave empty to keep current)":""]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:u?"text":"password",id:"password",value:l,onChange:s=>f(s.target.value),className:`w-full px-4 py-2 rounded-lg bg-black/20 border border-white/10 
                           focus:border-blue-500/50 focus:ring-2 focus:ring-blue-500/30 
                           outline-none text-white placeholder-white/50`,placeholder:t.visibility!=="public"?"Keep current password":"Enter password",minLength:4}),e.jsx("button",{type:"button",onClick:()=>g(!u),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-white/70 hover:text-white",children:u?"Hide":"Show"})]}),e.jsx("p",{className:"text-xs text-white/60 mt-1",children:x?"Password is required when changing to private or secret":"Minimum 4 characters. Leave empty to keep the current password."})]}),b&&e.jsx("div",{className:"text-red-400 text-sm bg-red-500/10 p-2 rounded",children:b}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:p,disabled:h,className:`flex-1 px-4 py-2 rounded-lg border border-white/20 text-white/90 
                       hover:bg-white/5 transition-colors disabled:opacity-50`,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h,className:`flex-1 px-4 py-2 rounded-lg bg-blue-500/80 text-white 
                       hover:bg-blue-600/80 transition-colors disabled:opacity-50`,children:h?"Saving...":"Save Changes"})]})]})]})})},V=({room:t,isCreated:v=!1,onUpdate:p,onRoomEdited:i,onRoomDeleted:w,userCount:a=0})=>{const[y,l]=d.useState(!1),[f,u]=d.useState(!1),{joinRoomWithLoading:g}=P(),{user:b}=R(),r=k(),h=async o=>{if(o.target.closest(".room-actions")){o.stopPropagation();return}try{if(t.visibility==="private"||t.visibility==="secret"){if(b&&t.createdBy._id===b.id){await g(t._id,{delay:300});return}r(`/join/${t._id}`);return}await g(t._id,{delay:300})}catch(m){console.error("[RoomCard] Failed to join room:",m)}},n=async o=>{try{await D(t._id,o),l(!1),p?.(),i?.()}catch(m){throw console.error("[RoomCard] Failed to edit room:",m),m}},x=async o=>{if(o.stopPropagation(),!!window.confirm(`Are you sure you want to delete "${t.name}"? This action cannot be undone.`))try{u(!0),await _(t._id),p?.(),w?.()}catch(m){console.error("[RoomCard] Failed to delete room:",m),alert("Failed to delete room. Please try again.")}finally{u(!1)}},j=o=>{o.stopPropagation(),l(!0)},s=t.visibility==="private"?S:t.visibility==="secret"?N:C,c=t.visibility==="private"?"text-yellow-300 bg-yellow-500/20":t.visibility==="secret"?"text-red-300 bg-red-500/20":"text-green-300 bg-green-500/20";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{onClick:h,className:`cursor-pointer backdrop-blur-md bg-white/10 border border-white/20 
                  text-white rounded-2xl p-6 shadow-xl flex flex-col justify-between 
                  transition hover:scale-[1.02] relative ${f?"opacity-50 pointer-events-none":""}`,children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:t.name}),e.jsxs("span",{className:`text-xs px-2 py-1 rounded-full flex items-center gap-1 ${c}`,children:[e.jsx(s,{size:10}),e.jsx("span",{children:t.visibility==="private"?"Private":t.visibility==="secret"?"Secret":"Public"})]})]}),e.jsxs("p",{className:"text-sm text-white/70 mt-2",children:["Created by"," ",e.jsx("span",{className:"font-medium",children:t.createdBy.username})]})]}),e.jsxs("div",{className:"text-sm text-white/70 mt-auto flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("p",{children:["ðŸ“… ",new Date(t.createdAt).toLocaleDateString()]}),t.visibility==="public"||t.createdBy._id===b?.id?e.jsxs("span",{className:"ml-2 px-2 py-1 bg-blue-500/20 rounded text-blue-200 text-xs",children:["ðŸ‘¥"," ",a??0," ","online"]}):e.jsxs("span",{className:"ml-2 px-2 py-1 bg-blue-500/20 rounded text-blue-200 text-xs inline-flex",children:["ðŸ‘¥",e.jsx(N,{className:"mt-1 ml-1"})]})]}),v&&e.jsxs("div",{className:"flex gap-2 room-actions",children:[e.jsx("button",{onClick:j,className:"p-2 bg-blue-500/50 hover:bg-blue-600/50 rounded-full transition-colors",title:"Edit Room",children:e.jsx(E,{size:14})}),e.jsx("button",{onClick:x,className:"p-2 bg-red-500/50 hover:bg-red-600/50 rounded-full transition-colors",title:"Delete Room",disabled:f,children:e.jsx(F,{size:14})})]})]})]}),y&&e.jsx(L,{room:t,onSave:n,onCancel:()=>l(!1)})]})};export{V as default};
