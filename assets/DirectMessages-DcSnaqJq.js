import{j as e}from"./ui-vendor-BEMU751j.js";import{u as k,r}from"./react-vendor-oin3n_bH.js";import{g as S,s as C}from"./social-PyUT3FD-.js";import{v as M}from"./auth-CEE9aHD-.js";import"./chat-xRr-uYkC.js";import{F as D,a as U,b as F}from"./index-DYiw4HW8.js";import"./socket-vendor-BLRFddlS.js";import"./editor-vendor-DpIsqUJN.js";const H=()=>{const i=k(),[n,f]=r.useState([]),[o,c]=r.useState([]),[d,p]=r.useState(""),[m,a]=r.useState(!1),[y,j]=r.useState(!0),[l,x]=r.useState({message:"",type:"info",visible:!1}),h=(s,t)=>{x({message:s,type:t,visible:!0})};r.useEffect(()=>{(async()=>{try{const t=await S();f(t.data.contacts)}catch(t){console.error("Error fetching contacts:",t),h("Failed to load contacts","error")}finally{j(!1)}})()},[]);const v=async s=>{if(p(s),!s.trim()){c([]),a(!1);return}a(!0);try{const t=await C(s);c(t.data.users)}catch(t){console.error("Error searching users:",t),h("Failed to search users","error")}},b=s=>{const t=new Date(s),g=new Date().getTime()-t.getTime(),N=g/(1e3*60*60),w=g/(1e3*60*60*24);return N<24?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):w<7?t.toLocaleDateString([],{weekday:"short"}):t.toLocaleDateString([],{month:"short",day:"numeric"})},u=({user:s,size:t="w-12 h-12"})=>s.avatar?e.jsx("img",{src:s.avatar,alt:s.username,className:`${t} rounded-full object-cover`}):e.jsx("div",{className:`${t} rounded-full bg-purple-600 flex items-center justify-center`,children:e.jsx("span",{className:"text-white font-semibold",children:s.username.charAt(0).toUpperCase()})});return y?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})}):e.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-gray-900",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Messages"}),e.jsx("button",{onClick:()=>a(!m),className:"p-2 rounded-lg bg-purple-600 text-white hover:bg-purple-700",children:e.jsx(D,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search users...",value:d,onChange:s=>v(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:m&&d.trim()?e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:"Search Results"}),o.length===0?e.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"No users found"}):e.jsx("div",{className:"space-y-2",children:o.map(s=>e.jsx("button",{onClick:()=>i(`/direct-messages/${s._id}`),className:"w-full p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(u,{user:s}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:s.username})})]})},s._id))})]}):e.jsx("div",{className:"p-4",children:n.length===0?e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:[e.jsx(F,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No conversations yet"}),e.jsx("p",{className:"text-sm mt-2",children:"Search for users to start messaging"})]}):e.jsx("div",{className:"space-y-2",children:n.map(s=>e.jsx("button",{onClick:()=>i(`/direct-messages/${s.otherUser._id}`),className:"w-full p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx(u,{user:s.otherUser}),s.unreadCount>0&&e.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:s.unreadCount>9?"9+":s.unreadCount})]}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:s.otherUser.username}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:s.lastMessage&&b(s.lastMessage.createdAt)})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:s.lastMessage?.imageUrl?"ðŸ“· Image":s.lastMessage?.content})]})]})},s.otherUser._id))})})}),e.jsx(M,{message:l.message,type:l.type,isVisible:l.visible,onClose:()=>x(s=>({...s,visible:!1}))})]})};export{H as default};
