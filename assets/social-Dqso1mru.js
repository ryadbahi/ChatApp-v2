const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FriendsList-BHFO3DoK.js","assets/ui-vendor-BEMU751j.js","assets/react-vendor-oin3n_bH.js","assets/auth-CMvCJYTb.js","assets/socket-vendor-BLRFddlS.js","assets/chat-DTYdApTY.js","assets/editor-vendor-DpIsqUJN.js","assets/DMThreadsMenu-myD6uYwU.js","assets/index-DDzt2cNA.js","assets/RichMessageInput-Xgrtx_v9.js"])))=>i.map(i=>d[i]);
import{j as e,A as b,m as v}from"./ui-vendor-BEMU751j.js";import{r}from"./react-vendor-oin3n_bH.js";import{i as a,e as N,m as _,n as F,o as D,p as A,q}from"./auth-CMvCJYTb.js";import{_ as h}from"./chat-DTYdApTY.js";const x=async s=>(await a.post("/api/friends/request",{recipientId:s})).data,U=async s=>(await a.post(`/api/friends/accept/${s}`)).data,k=async s=>(await a.post(`/api/friends/reject/${s}`)).data,M=async s=>(await a.delete(`/api/friends/end/${s}`)).data,g=async()=>(await a.get("/api/friends")).data,R=async()=>(await a.get("/api/friends/requests")).data,V=Object.freeze(Object.defineProperty({__proto__:null,acceptFriendRequest:U,endFriendship:M,getFriendRequests:R,getFriends:g,rejectFriendRequest:k,sendFriendRequest:x},Symbol.toStringTag,{value:"Module"})),O=({user:s,isOpen:n,onClose:o,onOpenDM:l})=>{const{user:p}=N(),[d,i]=r.useState("loading"),m=r.useRef(null);r.useEffect(()=>{n&&s._id!==p?.id&&f()},[n,s._id,p?.id]),r.useEffect(()=>{const t=c=>{m.current&&!m.current.contains(c.target)&&o()};return n&&document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[n,o]);const f=async()=>{try{console.log("[UserActionDropdown] Checking friendship status for user:",s._id);const t=await g();if(console.log("[UserActionDropdown] Friends response:",t),t.success&&t.data&&Array.isArray(t.data)){const c=t.data.some(u=>u._id===s._id);console.log("[UserActionDropdown] Is friend?",c,"Friends list:",t.data.map(u=>u.username)),i(c?"friends":"none")}else console.log("[UserActionDropdown] No friends data or invalid response"),i("none")}catch(t){console.error("Error checking friendship status:",t),i("none")}},j=async()=>{try{console.log("[UserActionDropdown] Sending friend request to:",s._id),i("loading");const t=await x(s._id);console.log("[UserActionDropdown] Friend request response:",t),t.success?(console.log("[UserActionDropdown] Friend request sent successfully"),i("pending")):(console.log("[UserActionDropdown] Friend request failed:",t.message),t.message?.includes("already exists")||t.message?.includes("Already")?i("pending"):(i("none"),console.error("Friend request failed:",t.message)))}catch(t){console.error("Error sending friend request:",t),t.response?.status===400&&(t.response?.data?.msg?.includes("already exists")||t.response?.data?.msg?.includes("Already"))?(console.log("[UserActionDropdown] Friend request already exists, setting to pending"),i("pending")):i("none")}o()},y=()=>{l&&l(s._id),o()};return!n||s._id===p?.id?null:e.jsx(b,{children:e.jsxs(v.div,{ref:m,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.15},className:"fixed z-50 bg-white/10 backdrop-blur-md rounded-xl shadow-xl border border-white/20 p-1 min-w-[180px]",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 border-b border-white/20 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.avatar?e.jsx("img",{src:s.avatar,alt:s.username,className:"w-8 h-8 rounded-full border border-white/20"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-semibold",children:s.username.charAt(0).toUpperCase()})}),e.jsx("span",{className:"text-white font-medium text-sm",children:s.username})]}),e.jsx("button",{onClick:o,className:"text-white/60 hover:text-white/80 p-1",children:e.jsx(_,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"space-y-1",children:[d==="friends"&&e.jsxs("button",{onClick:y,className:"w-full flex items-center gap-3 p-2 text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors",children:[e.jsx(F,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-sm",children:"Send Message"})]}),d==="none"&&e.jsxs("button",{onClick:j,className:"w-full flex items-center gap-3 p-2 text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors",children:[e.jsx(D,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-sm",children:"Send Friend Request"})]}),d==="pending"&&e.jsxs("div",{className:"w-full flex items-center gap-3 p-2 text-white/60",children:[e.jsx(A,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{className:"text-sm",children:"Friend Request Sent"})]}),d==="friends"&&e.jsxs("div",{className:"w-full flex items-center gap-3 p-2 text-white/60",children:[e.jsx(q,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-sm",children:"Friends"})]}),d==="loading"&&e.jsxs("div",{className:"w-full flex items-center gap-3 p-2 text-white/60",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/20 border-t-white/60 rounded-full animate-spin"}),e.jsx("span",{className:"text-sm",children:"Loading..."})]})]})]})})},S=r.lazy(()=>h(()=>import("./FriendsList-BHFO3DoK.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),E=r.lazy(()=>h(()=>import("./DMThreadsMenu-myD6uYwU.js"),__vite__mapDeps([7,1,2,3,4,5,6]))),L=r.lazy(()=>h(()=>import("./index-DDzt2cNA.js"),__vite__mapDeps([8,1,2,3,4,9,5,6]))),w=()=>e.jsxs("div",{className:"animate-pulse bg-white/10 rounded-lg p-4",children:[e.jsx("div",{className:"h-4 bg-white/20 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-white/20 rounded w-1/2"})]}),z=()=>e.jsx("div",{className:"animate-pulse bg-white/10 rounded-lg p-2",children:e.jsx("div",{className:"h-6 bg-white/20 rounded w-16"})}),W=s=>e.jsx(r.Suspense,{fallback:e.jsx(w,{}),children:e.jsx(S,{...s})}),B=s=>e.jsx(r.Suspense,{fallback:e.jsx(z,{}),children:e.jsx(E,{...s})}),G=s=>e.jsx(r.Suspense,{fallback:e.jsx(w,{}),children:e.jsx(L,{...s})}),H=async(s,n=1,o=20)=>(await a.get(`/api/direct-messages/${s}`,{params:{page:n,limit:o}})).data,J=async()=>(await a.get("/api/direct-messages/conversations/recent")).data,T=async s=>(await a.put(`/api/direct-messages/${s}/read`)).data,K=T,Q=async()=>(await a.get("/api/friends")).data,X=async s=>(await a.get("/api/friends/search",{params:{query:s}})).data;export{B as D,W as F,O as U,G as a,H as b,g as c,R as d,M as e,U as f,Q as g,J as h,T as i,V as j,K as m,k as r,X as s};
